<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simplex算法地图生成工具</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a3a, #0d1824);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            font-size: 2.8rem;
            background: linear-gradient(90deg, #4CAF50, #2196F3);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #aaa;
            font-size: 1.1rem;
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.5;
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .canvas-container {
            flex: 1;
            min-width: 500px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        #mapCanvas {
            width: 100%;
            height: 500px;
            background-color: #0a1520;
            border-radius: 5px;
            display: block;
        }
        
        .controls {
            flex: 0 0 300px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        .controls h2 {
            color: #4CAF50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .slider-container input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #2a3a4a;
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
        }
        
        .slider-value {
            min-width: 40px;
            text-align: center;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .color-legend {
            display: flex;
            margin-top: 10px;
            height: 20px;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .color-legend span {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: #000;
            font-weight: bold;
        }
        
        button {
            display: block;
            width: 100%;
            padding: 12px;
            background: linear-gradient(90deg, #4CAF50, #2196F3);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        .terrain-types {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .terrain-type {
            padding: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .terrain-type:hover {
            background-color: rgba(76, 175, 80, 0.2);
        }
        
        .terrain-type.active {
            background-color: rgba(76, 175, 80, 0.4);
            border: 1px solid #4CAF50;
        }
        
        .info-panel {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .info-panel h3 {
            color: #2196F3;
            margin-bottom: 15px;
        }
        
        .info-panel p {
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #888;
            font-size: 0.9rem;
        }
        
        @media (max-width: 900px) {
            .content {
                flex-direction: column;
            }
            
            .canvas-container, .controls {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Simplex噪声地图生成工具</h1>
            <p class="subtitle">使用Simplex噪声算法生成自然、连续的地形图。调整参数以创建不同的地图类型，包括陆地、岛屿、山脉等。</p>
        </header>
        
        <div class="content">
            <div class="canvas-container">
                <canvas id="mapCanvas" width="800" height="500"></canvas>
                <div class="color-legend">
                    <span style="background-color: #1a237e;">深海</span>
                    <span style="background-color: #0d47a1;">海洋</span>
                    <span style="background-color: #1976d2;">浅海</span>
                    <span style="background-color: #4caf50;">平原</span>
                    <span style="background-color: #8bc34a;">森林</span>
                    <span style="background-color: #ff9800;">丘陵</span>
                    <span style="background-color: #795548;">山脉</span>
                    <span style="background-color: #9e9e9e;">雪山</span>
                </div>
            </div>
            
            <div class="controls">
                <h2>地图参数控制</h2>
                
                <div class="control-group">
                    <label for="seed">随机种子: <span id="seedValue">12345</span></label>
                    <div class="slider-container">
                        <input type="range" id="seed" min="1" max="99999" value="12345" step="1">
                    </div>
                </div>
                
                <div class="control-group">
                    <label for="scale">噪声缩放: <span id="scaleValue">100</span></label>
                    <div class="slider-container">
                        <input type="range" id="scale" min="10" max="500" value="100" step="1">
                    </div>
                </div>
                
                <div class="control-group">
                    <label for="octaves">噪声层数: <span id="octavesValue">4</span></label>
                    <div class="slider-container">
                        <input type="range" id="octaves" min="1" max="8" value="4" step="1">
                    </div>
                </div>
                
                <div class="control-group">
                    <label for="persistence">持续性: <span id="persistenceValue">0.5</span></label>
                    <div class="slider-container">
                        <input type="range" id="persistence" min="0.1" max="1" value="0.5" step="0.05">
                    </div>
                </div>
                
                <div class="control-group">
                    <label for="lacunarity">频率: <span id="lacunarityValue">2.0</span></label>
                    <div class="slider-container">
                        <input type="range" id="lacunarity" min="1" max="4" value="2.0" step="0.1">
                    </div>
                </div>
                
                <div class="control-group">
                    <label for="seaLevel">海平面: <span id="seaLevelValue">0.3</span></label>
                    <div class="slider-container">
                        <input type="range" id="seaLevel" min="0" max="1" value="0.3" step="0.01">
                    </div>
                </div>
                
                <button id="generateBtn">生成新地图</button>
                <button id="randomSeedBtn">随机种子</button>
                
                <h2 style="margin-top: 30px;">地形类型预设</h2>
                <div class="terrain-types">
                    <div class="terrain-type active" data-type="continent">大陆</div>
                    <div class="terrain-type" data-type="islands">岛屿</div>
                    <div class="terrain-type" data-type="mountains">山脉</div>
                    <div class="terrain-type" data-type="archipelago">群岛</div>
                </div>
            </div>
        </div>
        
        <div class="info-panel">
            <h3>关于Simplex噪声算法</h3>
            <p>Simplex噪声是由Ken Perlin在2001年开发的一种改进的Perlin噪声算法。与Perlin噪声相比，Simplex噪声具有以下优势：</p>
            <p>1. 计算复杂度更低，尤其在更高维度上表现更好</p>
            <p>2. 方向性伪影更少，生成的结果更加自然</p>
            <p>3. 在计算上更高效，尤其是在GPU上实现时</p>
            <p>本工具使用2D Simplex噪声生成地形高度图，然后根据高度值分配不同的颜色来模拟各种地形类型。</p>
        </div>
        
        <footer>
            <p>Simplex噪声地图生成工具 &copy; 2025 | 使用HTML5 Canvas和JavaScript实现</p>
        </footer>
    </div>

    <script>
        // 获取Canvas和Context
        const canvas = document.getElementById('mapCanvas');
        const ctx = canvas.getContext('2d');
        
        // 获取控制元素
        const seedSlider = document.getElementById('seed');
        const scaleSlider = document.getElementById('scale');
        const octavesSlider = document.getElementById('octaves');
        const persistenceSlider = document.getElementById('persistence');
        const lacunaritySlider = document.getElementById('lacunarity');
        const seaLevelSlider = document.getElementById('seaLevel');
        
        const seedValue = document.getElementById('seedValue');
        const scaleValue = document.getElementById('scaleValue');
        const octavesValue = document.getElementById('octavesValue');
        const persistenceValue = document.getElementById('persistenceValue');
        const lacunarityValue = document.getElementById('lacunarityValue');
        const seaLevelValue = document.getElementById('seaLevelValue');
        
        const generateBtn = document.getElementById('generateBtn');
        const randomSeedBtn = document.getElementById('randomSeedBtn');
        const terrainTypes = document.querySelectorAll('.terrain-type');
        
        // 地形颜色映射
        const terrainColors = [
            {threshold: 0.0, color: '#1a237e', name: '深海'},      // 深蓝
            {threshold: 0.2, color: '#0d47a1', name: '海洋'},      // 蓝色
            {threshold: 0.3, color: '#1976d2', name: '浅海'},      // 浅蓝
            {threshold: 0.4, color: '#4caf50', name: '平原'},      // 绿色
            {threshold: 0.6, color: '#8bc34a', name: '森林'},      // 浅绿
            {threshold: 0.75, color: '#ff9800', name: '丘陵'},     // 橙色
            {threshold: 0.85, color: '#795548', name: '山脉'},     // 棕色
            {threshold: 0.95, color: '#9e9e9e', name: '雪山'}      // 灰色
        ];
        
        // 地形预设
        const terrainPresets = {
            continent: {scale: 100, octaves: 4, persistence: 0.5, lacunarity: 2.0, seaLevel: 0.3},
            islands: {scale: 200, octaves: 6, persistence: 0.4, lacunarity: 2.5, seaLevel: 0.4},
            mountains: {scale: 80, octaves: 5, persistence: 0.6, lacunarity: 1.8, seaLevel: 0.2},
            archipelago: {scale: 150, octaves: 7, persistence: 0.3, lacunarity: 3.0, seaLevel: 0.5}
        };
        
        // Simplex噪声实现
        class SimplexNoise {
            constructor(seed) {
                this.grad3 = [
                    [1,1,0], [-1,1,0], [1,-1,0], [-1,-1,0],
                    [1,0,1], [-1,0,1], [1,0,-1], [-1,0,-1],
                    [0,1,1], [0,-1,1], [0,1,-1], [0,-1,-1]
                ];
                
                this.p = [];
                this.perm = [];
                
                // 初始化排列表
                for (let i = 0; i < 256; i++) {
                    this.p[i] = Math.floor(this.random(seed) * 256);
                }
                
                // 为了简化，我们复制排列表
                for (let i = 0; i < 512; i++) {
                    this.perm[i] = this.p[i & 255];
                }
            }
            
            random(seed) {
                const x = Math.sin(seed) * 10000;
                return x - Math.floor(x);
            }
            
            dot(g, x, y) {
                return g[0]*x + g[1]*y;
            }
            
            noise(xin, yin) {
                // Simplex噪声的2D实现
                const F2 = 0.5 * (Math.sqrt(3.0) - 1.0);
                const G2 = (3.0 - Math.sqrt(3.0)) / 6.0;
                
                let s = (xin + yin) * F2;
                let i = Math.floor(xin + s);
                let j = Math.floor(yin + s);
                
                let t = (i + j) * G2;
                let X0 = i - t;
                let Y0 = j - t;
                let x0 = xin - X0;
                let y0 = yin - Y0;
                
                let i1, j1;
                if (x0 > y0) {
                    i1 = 1; j1 = 0;
                } else {
                    i1 = 0; j1 = 1;
                }
                
                let x1 = x0 - i1 + G2;
                let y1 = y0 - j1 + G2;
                let x2 = x0 - 1.0 + 2.0 * G2;
                let y2 = y0 - 1.0 + 2.0 * G2;
                
                let ii = i & 255;
                let jj = j & 255;
                
                let gi0 = this.perm[ii + this.perm[jj]] % 12;
                let gi1 = this.perm[ii + i1 + this.perm[jj + j1]] % 12;
                let gi2 = this.perm[ii + 1 + this.perm[jj + 1]] % 12;
                
                let t0 = 0.5 - x0*x0 - y0*y0;
                let n0 = 0;
                if (t0 >= 0) {
                    t0 *= t0;
                    n0 = t0 * t0 * this.dot(this.grad3[gi0], x0, y0);
                }
                
                let t1 = 0.5 - x1*x1 - y1*y1;
                let n1 = 0;
                if (t1 >= 0) {
                    t1 *= t1;
                    n1 = t1 * t1 * this.dot(this.grad3[gi1], x1, y1);
                }
                
                let t2 = 0.5 - x2*x2 - y2*y2;
                let n2 = 0;
                if (t2 >= 0) {
                    t2 *= t2;
                    n2 = t2 * t2 * this.dot(this.grad3[gi2], x2, y2);
                }
                
                return 70.0 * (n0 + n1 + n2);
            }
        }
        
        // 分形噪声生成
        function fractalNoise(x, y, scale, octaves, persistence, lacunarity, noise) {
            let value = 0;
            let amplitude = 1;
            let frequency = 1;
            let maxValue = 0;
            
            for (let i = 0; i < octaves; i++) {
                value += noise.noise(x * frequency / scale, y * frequency / scale) * amplitude;
                maxValue += amplitude;
                amplitude *= persistence;
                frequency *= lacunarity;
            }
            
            return value / maxValue;
        }
        
        // 生成地图
        function generateMap() {
            const seed = parseInt(seedSlider.value);
            const scale = parseFloat(scaleSlider.value);
            const octaves = parseInt(octavesSlider.value);
            const persistence = parseFloat(persistenceSlider.value);
            const lacunarity = parseFloat(lacunaritySlider.value);
            const seaLevel = parseFloat(seaLevelSlider.value);
            
            const width = canvas.width;
            const height = canvas.height;
            
            // 创建Simplex噪声实例
            const simplex = new SimplexNoise(seed);
            
            // 创建图像数据
            const imageData = ctx.createImageData(width, height);
            const data = imageData.data;
            
            // 生成高度图并设置颜色
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    // 使用分形噪声生成高度值
                    let elevation = fractalNoise(x, y, scale, octaves, persistence, lacunarity, simplex);
                    
                    // 归一化到0-1范围
                    elevation = (elevation + 1) / 2;
                    
                    // 应用海平面
                    if (elevation < seaLevel) {
                        elevation = elevation / seaLevel * 0.3;
                    } else {
                        elevation = 0.3 + (elevation - seaLevel) / (1 - seaLevel) * 0.7;
                    }
                    
                    // 确保在0-1范围内
                    elevation = Math.max(0, Math.min(1, elevation));
                    
                    // 根据高度选择颜色
                    let color = terrainColors[terrainColors.length - 1].color;
                    for (let i = 0; i < terrainColors.length; i++) {
                        if (elevation < terrainColors[i].threshold) {
                            color = terrainColors[i].color;
                            break;
                        }
                    }
                    
                    // 将颜色转换为RGB
                    const r = parseInt(color.substr(1, 2), 16);
                    const g = parseInt(color.substr(3, 2), 16);
                    const b = parseInt(color.substr(5, 2), 16);
                    
                    // 设置像素颜色
                    const index = (y * width + x) * 4;
                    data[index] = r;     // 红
                    data[index + 1] = g; // 绿
                    data[index + 2] = b; // 蓝
                    data[index + 3] = 255; // 透明度
                }
            }
            
            // 将图像数据绘制到画布
            ctx.putImageData(imageData, 0, 0);
        }
        
        // 更新显示值
        function updateValues() {
            seedValue.textContent = seedSlider.value;
            scaleValue.textContent = scaleSlider.value;
            octavesValue.textContent = octavesSlider.value;
            persistenceValue.textContent = persistenceSlider.value;
            lacunarityValue.textContent = lacunaritySlider.value;
            seaLevelValue.textContent = seaLevelSlider.value;
        }
        
        // 应用地形预设
        function applyTerrainPreset(presetName) {
            const preset = terrainPresets[presetName];
            
            scaleSlider.value = preset.scale;
            octavesSlider.value = preset.octaves;
            persistenceSlider.value = preset.persistence;
            lacunaritySlider.value = preset.lacunarity;
            seaLevelSlider.value = preset.seaLevel;
            
            updateValues();
            generateMap();
        }
        
        // 事件监听器
        seedSlider.addEventListener('input', () => {
            updateValues();
            generateMap();
        });
        
        scaleSlider.addEventListener('input', () => {
            updateValues();
            generateMap();
        });
        
        octavesSlider.addEventListener('input', () => {
            updateValues();
            generateMap();
        });
        
        persistenceSlider.addEventListener('input', () => {
            updateValues();
            generateMap();
        });
        
        lacunaritySlider.addEventListener('input', () => {
            updateValues();
            generateMap();
        });
        
        seaLevelSlider.addEventListener('input', () => {
            updateValues();
            generateMap();
        });
        
        generateBtn.addEventListener('click', () => {
            generateMap();
        });
        
        randomSeedBtn.addEventListener('click', () => {
            const randomSeed = Math.floor(Math.random() * 99999) + 1;
            seedSlider.value = randomSeed;
            updateValues();
            generateMap();
        });
        
        // 地形类型选择
        terrainTypes.forEach(type => {
            type.addEventListener('click', () => {
                // 移除所有active类
                terrainTypes.forEach(t => t.classList.remove('active'));
                // 添加active类到当前选择
                type.classList.add('active');
                
                // 应用预设
                const presetType = type.getAttribute('data-type');
                applyTerrainPreset(presetType);
            });
        });
        
        // 初始生成地图
        updateValues();
        generateMap();
    </script>
</body>
</html>